const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-DQpLtAJc.js","assets/utilities-B1GvWzLx.js"])))=>i.map(i=>d[i]);
import{_ as yt}from"./preload-helper-DrSbU_pJ.js";import{e as L,s as W}from"./utilities-B1GvWzLx.js";import{b as bt,V as y,M as x,T as I,Q as J,c as tt,d as b,R as gt,e as wt,f as Et,G as Pt,B as xt,a as Tt,S as kt,P as Lt,W as Dt,A as St,D as Mt,C as Ct}from"./GLTFLoader-geCNiA8N.js";const et=document.getElementById("navbarContainer"),ht=new URL("/Luminara/",document.baseURI).href,vt=new URL("navbar.html",ht).href;fetch(vt).then(e=>e.text()).then(e=>{et.innerHTML=e,[...et.querySelectorAll(".nav-link, .mobile-nav-link"),...document.querySelectorAll(".bread-link"),...document.querySelectorAll(".logo-link")].forEach(i=>{i.dataset.path&&(i.href=ht+i.dataset.path)}),yt(()=>import("./main-DQpLtAJc.js"),__vite__mapDeps([0,1])).then(i=>i.initPage?.())}).catch(e=>console.error(e));const ct="/Luminara/";function Ot(){document.querySelectorAll(".panel").forEach(t=>{const i=t.querySelector(".panel-header"),s=t.querySelector(".panel-content"),o=i.querySelector("i.fa-chevron-down");let a=!1;i.addEventListener("click",()=>{a=!a,s.classList.toggle("hidden"),o?.classList.toggle("rotate-180",a),o?.classList.toggle("rotate-0",!a)})})}function Rt(){const e=document.getElementById("resizer"),t=document.getElementById("information");if(!e||!t)return;let i=!1;e.addEventListener("mousedown",()=>{i=!0,document.body.style.cursor="col-resize",document.body.style.userSelect="none"}),document.addEventListener("mousemove",s=>{if(!i)return;const o=e.parentNode.getBoundingClientRect(),a=s.clientX-o.left,n=o.width;let r=n-a;const h=300,l=n*.5;r=Math.min(Math.max(r,h),l),t.style.flexBasis=`${r}px`,t.style.width="auto"}),document.addEventListener("mouseup",()=>{i&&(i=!1,document.body.style.cursor="",document.body.style.userSelect="")})}function At(e){const t=document.querySelector(".breadcrumb .hero-name");t&&(t.textContent=L(e.name),t.href=`${ct}hero_details.html?id=${encodeURIComponent(e.id)}`)}function jt(e){const t=Object.values(e.skins).filter(r=>!r.painted_of).sort((r,h)=>r.release_order-h.release_order),i=document.getElementById("skin-dropdown-btn"),s=document.getElementById("skin-dropdown-current"),o=document.getElementById("skin-dropdown-list");if(!o)return t;o.textContent="";let a=window.skinId;const n=Object.values(e.skins).find(r=>r.skin_id===window.skinId);if(n?.painted_of){const r=Object.values(e.skins).find(h=>h.name===n.painted_of);r&&(a=r.skin_id)}return t.forEach(r=>{const h=document.createElement("li"),l=document.createElement("a");l.textContent=L(r.name),l.className="block px-4 py-2 hover:bg-primary break-words",l.href=`${ct}mlbb_model_viewer.html?id=${encodeURIComponent(e.id)}&skin_id=${encodeURIComponent(r.skin_id)}&model_type=in_game`,r.skin_id===a?(l.classList.add("font-semibold","text-primary"),s&&(s.textContent=L(r.name))):l.classList.add("text-text"),h.appendChild(l),o.appendChild(h)}),i?.addEventListener("click",()=>o.classList.toggle("hidden")),document.addEventListener("click",r=>{i&&o&&!i.contains(r.target)&&!o.contains(r.target)&&o.classList.add("hidden")}),t}function It(e){At(e),jt(e)}function it(e,t){const i="/Luminara/",s=l=>W(l?`${i}${l}`:""),o=document.getElementById("hero-avatar");if(o){const l=t.avatars?.default||"assets/default_avatar.png";o.src=s(l),o.alt=L(t.name||"Hero Avatar")}const a=document.getElementById("skin-name");a&&(a.textContent=L(t.name));const n=document.getElementById("skin-lore");n&&(n.textContent=L(e.lore)||"No lore available.");const r=document.getElementById("btn-splash");r&&(r.onclick=()=>{t.splash_art?.default?window.open(s(t.splash_art.default),"_blank"):alert("No splash art available for this skin.")});const h=document.getElementById("btn-portrait");h&&(h.onclick=()=>{t.portraits?.default?window.open(s(t.portraits.default),"_blank"):alert("No portrait available for this skin.")})}function X(e){const t=String(e||"").trim();return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(t)?t:["red","green","blue","yellow","black","white","transparent","orange","purple","pink","cyan","gray"].includes(t.toLowerCase())?t.toLowerCase():"#ccc"}function nt(e,t){const i=document.querySelector(".models-list");if(i){i.textContent="";const n=window.modelType||"entrance";[{type:"entrance",label:"Entrance"},{type:"in_game",label:"In Game"},{type:"raw",label:"Raw"}].forEach(h=>{const l=document.createElement("a"),m=new URL(window.location.pathname,window.location.origin);m.searchParams.set("id",e.id),m.searchParams.set("skin_id",t.skin_id),m.searchParams.set("model_type",h.type),l.href=W(m.href),l.className="flex-1 flex items-center justify-center gap-2 rounded h-10 min-w-0 overflow-hidden cursor-pointer transition "+(h.type===n?"bg-primary text-white font-semibold":"bg-background text-text hover:bg-primary/20");const w=document.createElement("span");w.className="truncate",w.textContent=L(h.label),l.appendChild(w),i.appendChild(l)})}const s=document.querySelector(".painted-list .painted");if(!s)return;s.textContent="";const o=t.painted_of?Object.values(e.skins).find(n=>n.name===t.painted_of):t;if(!o)return;const a=(n,r)=>{const h=document.createElement("a"),l=new URL(window.location.pathname,window.location.origin);l.searchParams.set("id",e.id),l.searchParams.set("skin_id",n.skin_id),l.searchParams.set("model_type",window.modelType),h.href=W(l.href),h.className="w-10 h-10 rounded-full flex items-center justify-center transition-transform hover:scale-110 border border-text",h.title=L(n.name);const m=document.createElement("i");m.className="fa-solid fa-shirt text-lg pointer-events-none",r.length===1?m.style.color=X(r[0]):r.length===2?(m.style.background=`linear-gradient(to right, ${X(r[0])} 50%, ${X(r[1])} 50%)`,m.style.WebkitBackgroundClip="text",m.style.webkitTextFillColor="transparent"):m.style.color="#ccc",h.appendChild(m),n.skin_id===t.skin_id&&h.classList.add("ring-1","ring-primary","ring-offset-1"),s.appendChild(h)};a(o,["#00000000"]),Object.values(e.skins).filter(n=>n.painted_of===o.name).forEach(n=>{const r=Array.isArray(n.painted_color)?n.painted_color:[n.painted_color||"#ccc"];a(n,r)})}const st={type:"change"},G={type:"start"},dt={type:"end"},K=new gt,ot=new wt,Nt=Math.cos(70*Et.DEG2RAD),u=new y,f=2*Math.PI,c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},$=1e-6;class Ut extends bt{constructor(t,i=null){super(t,i),this.state=c.NONE,this.target=new y,this.cursor=new y,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:x.ROTATE,MIDDLE:x.DOLLY,RIGHT:x.PAN},this.touches={ONE:I.ROTATE,TWO:I.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new y,this._lastQuaternion=new J,this._lastTargetPosition=new y,this._quat=new J().setFromUnitVectors(t.up,new y(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new tt,this._sphericalDelta=new tt,this._scale=1,this._panOffset=new y,this._rotateStart=new b,this._rotateEnd=new b,this._rotateDelta=new b,this._panStart=new b,this._panEnd=new b,this._panDelta=new b,this._dollyStart=new b,this._dollyEnd=new b,this._dollyDelta=new b,this._dollyDirection=new y,this._mouse=new b,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Yt.bind(this),this._onPointerDown=zt.bind(this),this._onPointerUp=Bt.bind(this),this._onContextMenu=Xt.bind(this),this._onMouseWheel=Ft.bind(this),this._onKeyDown=Kt.bind(this),this._onTouchStart=Wt.bind(this),this._onTouchMove=qt.bind(this),this._onMouseDown=Ht.bind(this),this._onMouseMove=Zt.bind(this),this._interceptControlDown=$t.bind(this),this._interceptControlUp=Gt.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(st),this.update(),this.state=c.NONE}update(t=null){const i=this.object.position;u.copy(i).sub(this.target),u.applyQuaternion(this._quat),this._spherical.setFromVector3(u),this.autoRotate&&this.state===c.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,o=this.maxAzimuthAngle;isFinite(s)&&isFinite(o)&&(s<-Math.PI?s+=f:s>Math.PI&&(s-=f),o<-Math.PI?o+=f:o>Math.PI&&(o-=f),s<=o?this._spherical.theta=Math.max(s,Math.min(o,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+o)/2?Math.max(s,this._spherical.theta):Math.min(o,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const n=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=n!=this._spherical.radius}if(u.setFromSpherical(this._spherical),u.applyQuaternion(this._quatInverse),i.copy(this.target).add(u),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let n=null;if(this.object.isPerspectiveCamera){const r=u.length();n=this._clampDistance(r*this._scale);const h=r-n;this.object.position.addScaledVector(this._dollyDirection,h),this.object.updateMatrixWorld(),a=!!h}else if(this.object.isOrthographicCamera){const r=new y(this._mouse.x,this._mouse.y,0);r.unproject(this.object);const h=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=h!==this.object.zoom;const l=new y(this._mouse.x,this._mouse.y,0);l.unproject(this.object),this.object.position.sub(l).add(r),this.object.updateMatrixWorld(),n=u.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;n!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(n).add(this.object.position):(K.origin.copy(this.object.position),K.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(K.direction))<Nt?this.object.lookAt(this.target):(ot.setFromNormalAndCoplanarPoint(this.object.up,this.target),K.intersectPlane(ot,this.target))))}else if(this.object.isOrthographicCamera){const n=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),n!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,a||this._lastPosition.distanceToSquared(this.object.position)>$||8*(1-this._lastQuaternion.dot(this.object.quaternion))>$||this._lastTargetPosition.distanceToSquared(this.target)>$?(this.dispatchEvent(st),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?f/60*this.autoRotateSpeed*t:f/60/60*this.autoRotateSpeed}_getZoomScale(t){const i=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*i)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,i){u.setFromMatrixColumn(i,0),u.multiplyScalar(-t),this._panOffset.add(u)}_panUp(t,i){this.screenSpacePanning===!0?u.setFromMatrixColumn(i,1):(u.setFromMatrixColumn(i,0),u.crossVectors(this.object.up,u)),u.multiplyScalar(t),this._panOffset.add(u)}_pan(t,i){const s=this.domElement;if(this.object.isPerspectiveCamera){const o=this.object.position;u.copy(o).sub(this.target);let a=u.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*a/s.clientHeight,this.object.matrix),this._panUp(2*i*a/s.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),this._panUp(i*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,i){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const s=this.domElement.getBoundingClientRect(),o=t-s.left,a=i-s.top,n=s.width,r=s.height;this._mouse.x=o/n*2-1,this._mouse.y=-(a/r)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft(f*this._rotateDelta.x/i.clientHeight),this._rotateUp(f*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let i=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(f*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),i=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-f*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),i=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(f*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),i=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-f*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),i=!0;break}i&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const i=this._getSecondPointerPosition(t),s=.5*(t.pageX+i.x),o=.5*(t.pageY+i.y);this._rotateStart.set(s,o)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const i=this._getSecondPointerPosition(t),s=.5*(t.pageX+i.x),o=.5*(t.pageY+i.y);this._panStart.set(s,o)}}_handleTouchStartDolly(t){const i=this._getSecondPointerPosition(t),s=t.pageX-i.x,o=t.pageY-i.y,a=Math.sqrt(s*s+o*o);this._dollyStart.set(0,a)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const s=this._getSecondPointerPosition(t),o=.5*(t.pageX+s.x),a=.5*(t.pageY+s.y);this._rotateEnd.set(o,a)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft(f*this._rotateDelta.x/i.clientHeight),this._rotateUp(f*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const i=this._getSecondPointerPosition(t),s=.5*(t.pageX+i.x),o=.5*(t.pageY+i.y);this._panEnd.set(s,o)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const i=this._getSecondPointerPosition(t),s=t.pageX-i.x,o=t.pageY-i.y,a=Math.sqrt(s*s+o*o);this._dollyEnd.set(0,a),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const n=(t.pageX+i.x)*.5,r=(t.pageY+i.y)*.5;this._updateZoomParameters(n,r)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==t.pointerId){this._pointers.splice(i,1);return}}_isTrackingPointer(t){for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==t.pointerId)return!0;return!1}_trackPointer(t){let i=this._pointerPositions[t.pointerId];i===void 0&&(i=new b,this._pointerPositions[t.pointerId]=i),i.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const i=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[i]}_customWheelEvent(t){const i=t.deltaMode,s={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(i){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}}function zt(e){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(e)&&(this._addPointer(e),e.pointerType==="touch"?this._onTouchStart(e):this._onMouseDown(e)))}function Yt(e){this.enabled!==!1&&(e.pointerType==="touch"?this._onTouchMove(e):this._onMouseMove(e))}function Bt(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(dt),this.state=c.NONE;break;case 1:const t=this._pointers[0],i=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:i.x,pageY:i.y});break}}function Ht(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case x.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(e),this.state=c.DOLLY;break;case x.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=c.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=c.ROTATE}break;case x.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=c.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=c.PAN}break;default:this.state=c.NONE}this.state!==c.NONE&&this.dispatchEvent(G)}function Zt(e){switch(this.state){case c.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(e);break;case c.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(e);break;case c.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(e);break}}function Ft(e){this.enabled===!1||this.enableZoom===!1||this.state!==c.NONE||(e.preventDefault(),this.dispatchEvent(G),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(dt))}function Kt(e){this.enabled!==!1&&this._handleKeyDown(e)}function Wt(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case I.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(e),this.state=c.TOUCH_ROTATE;break;case I.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(e),this.state=c.TOUCH_PAN;break;default:this.state=c.NONE}break;case 2:switch(this.touches.TWO){case I.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(e),this.state=c.TOUCH_DOLLY_PAN;break;case I.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(e),this.state=c.TOUCH_DOLLY_ROTATE;break;default:this.state=c.NONE}break;default:this.state=c.NONE}this.state!==c.NONE&&this.dispatchEvent(G)}function qt(e){switch(this._trackPointer(e),this.state){case c.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(e),this.update();break;case c.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(e),this.update();break;case c.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(e),this.update();break;case c.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=c.NONE}}function Xt(e){this.enabled!==!1&&e.preventDefault()}function $t(e){e.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Gt(e){e.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Vt(e=[],t){if(!e.length||!t)return;let i=0,s=!0;const o=[1,2,.1,.5];let a=0,n=null;const r=document.getElementById("btn-prev"),h=document.getElementById("btn-next"),l=document.getElementById("btn-playpause"),m=l?.querySelector("i"),w=document.getElementById("progress-bar"),B=document.getElementById("btn-speed"),H=B?.querySelector("span"),D=document.getElementById("btn-animation-list"),v=document.getElementById("current-animation");let p=null,O=null,U=null;function V(d){return String(d)}function q(d){const S=["_in_game_","_entrance_"];for(const z of S){const M=d.indexOf(z);if(M!==-1)return d.slice(M+z.length)}return d}function Z(d){if(!e.length)return;n&&n.stop(),i=(d+e.length)%e.length;const S=e[i];n=t.clipAction(S),n.reset(),n.setEffectiveTimeScale(o[a]),n.play(),v.textContent=V(q(S.name)),p&&(p.remove(),p=null,window.removeEventListener("scroll",updatePopupPosition,!0))}function pt(){n&&(s?(n.paused=!0,m?.classList.replace("fa-pause","fa-play")):(n.paused=!1,m?.classList.replace("fa-play","fa-pause")),s=!s)}function ut(){a=(a+1)%o.length;const d=o[a];H&&(H.textContent=`${d}x`),n&&n.setEffectiveTimeScale(d)}function mt(){if(!n||!n.getClip())return;const d=n.getClip().duration;w.value=n.time%d/d*100}function ft(d){!n||!n.getClip()||(n.time=d/100*n.getClip().duration)}function _t(){if(!D)return;if(p){p.remove(),p=null,window.removeEventListener("scroll",M,!0);return}p=document.createElement("div"),p.className="absolute z-50 max-h-80 flex flex-col rounded shadow-lg bg-body border border-text-dull p-2 min-w-[300px]";const d=document.createElement("div");d.className="flex items-center gap-2 p-2 border-b border-text-dull";const S=document.createElement("i");S.className="fas fa-search text-text-dull",O=document.createElement("input"),O.type="text",O.placeholder="Search animation...",O.className="flex-1 px-2 py-1 rounded bg-background text-text outline-none",d.appendChild(S),d.appendChild(O),p.appendChild(d),U=document.createElement("div"),U.className="overflow-y-auto flex-1 p-1 scrollbar-thin scrollbar-thumb-primary scrollbar-track-background",p.appendChild(U);function z(_=""){U.textContent="",e.filter(T=>q(T.name).toLowerCase().includes(_.toLowerCase())).forEach((T,R)=>{const k=document.createElement("button");k.className="w-full text-left px-3 py-2 hover:bg-background rounded flex items-center",k.onclick=()=>Z(R);const F=document.createElement("i");F.className=R===i?"fas fa-check mr-2 text-primary":"mr-2",k.appendChild(F);const A=document.createElement("span");A.textContent=V(q(T.name)),A.className="text-text overflow-hidden whitespace-nowrap overflow-ellipsis",A.style.maxWidth="calc(100% - 20px)",k.appendChild(A),U.appendChild(k)})}z(),O.addEventListener("input",_=>z(_.target.value)),document.body.appendChild(p);function M(){const _=D.getBoundingClientRect(),T=p.offsetWidth,R=p.offsetHeight||220,k=window.innerHeight-_.bottom,F=_.top;k>R+10?p.style.top=`${_.bottom+window.scrollY+5}px`:F>R+10?p.style.top=`${_.top+window.scrollY-R-5}px`:(p.style.top=`${_.bottom+window.scrollY+5}px`,p.style.maxHeight=`${k-10}px`);const A=_.left+window.scrollX+_.width/2-T/2;p.style.left=`${Math.max(A,5)}px`}M(),window.addEventListener("scroll",M,!0),setTimeout(()=>{document.addEventListener("click",function _(T){!p.contains(T.target)&&!D.contains(T.target)&&(p.remove(),p=null,window.removeEventListener("scroll",M,!0),document.removeEventListener("click",_))},{capture:!0})},0)}D?.addEventListener("click",d=>{d.stopPropagation(),_t()}),r?.addEventListener("click",()=>Z(i-1)),h?.addEventListener("click",()=>Z(i+1)),l?.addEventListener("click",pt),B?.addEventListener("click",ut),w?.addEventListener("input",d=>ft(parseFloat(d.target.value)));function Q(){requestAnimationFrame(Q),mt()}Q(),Z(0),v&&(v.style.overflow="hidden",v.style.textOverflow="ellipsis",v.style.whiteSpace="nowrap",v.style.maxWidth="100%")}let P,g,j,C,N,at={},E,rt;function Y(e){if(!E){E=document.createElement("div"),E.className="absolute inset-0 flex items-center justify-center bg-black/70 text-white font-semibold text-lg z-30",E.style.pointerEvents="none";const t=document.querySelector(".mlbb_hero_viewer").parentNode;t.style.position="relative",t.appendChild(E)}E.textContent=e,E.style.display="flex"}function Qt(){E&&(E.style.display="none")}function Jt(e){P=new kt;const t=e.clientWidth||window.innerWidth,i=e.clientHeight||window.innerHeight;g=new Lt(45,t/i,.1,1e3),g.position.set(0,1,4),j=new Dt({canvas:e,antialias:!0,alpha:!0}),j.setSize(t,i),j.setPixelRatio(window.devicePixelRatio),P.add(new St(16777215,1.5));const s=new Mt(16777215,3);s.position.set(5,5,5),P.add(s),C=new Ut(g,j.domElement),C.enableDamping=!0,C.dampingFactor=.05,C.enablePan=!0,C.enableZoom=!0,C.mouseButtons={LEFT:x.ROTATE,MIDDLE:x.DOLLY,RIGHT:x.PAN},e.addEventListener("wheel",a=>a.preventDefault(),{passive:!1}),window.addEventListener("resize",()=>{const a=e.clientWidth||window.innerWidth,n=e.clientHeight||window.innerHeight;g.aspect=a/n,g.updateProjectionMatrix(),j.setSize(a,n)}),rt=new Ct;function o(){requestAnimationFrame(o),N&&N.update(rt.getDelta()),C.update(),j.render(P,g)}o()}async function lt(e,t){const i=document.querySelector("canvas.mlbb_hero_viewer");if(!i)return;for(P||Jt(i);P.children.length>2;)P.remove(P.children[2]);N=null,at={};let s=e.models?.[t];if(!s){Y("Model not found");return}s=W(s?`/Luminara/${s}`:""),Y("Loading…");try{if(!(await fetch(s,{method:"HEAD"})).ok){Y("Model not found");return}}catch{Y("Model not found");return}new Pt().load(s,n=>{Qt();const r=n.scene,h=new xt().setFromObject(r),l=new y;h.getSize(l);const m=h.getCenter(new y),w=Math.max(l.x,l.y,l.z),B=g.fov*(Math.PI/180);let H=Math.abs(w/2/Math.tan(B/2));g.position.set(0,l.y/2,H*1.2),g.near=w/100,g.far=w*100,g.updateProjectionMatrix(),r.position.sub(m),P.add(r),n.animations.length&&(N=new Tt(r),n.animations.forEach(D=>{at[D.name]=N.clipAction(D)}),Vt(n.animations,N))},void 0,()=>Y("Model not found"))}async function te(e){const t="/Luminara/",i=await fetch(`${t}data/heroes_index.json`);if(!i.ok)throw new Error("Failed to fetch heroes_index.json");const o=(await i.json()).heroes.find(n=>n.id===e);if(!o)throw new Error(`Hero with id=${e} not found`);const a=await fetch(`${t}data/heroes/${o.details_file}`);if(!a.ok)throw new Error(`Failed to fetch hero details: ${o.details_file}`);return await a.json()}document.addEventListener("DOMContentLoaded",()=>{function e(o){if(!o)return null;const a=o.match(/^[a-zA-Z0-9_-]+$/);return a?a[0]:null}const t=new URLSearchParams(window.location.search),i=e(t.get("id"));window.skinId=e(t.get("skin_id")),window.modelType=e(t.get("model_type"))||"in_game";async function s(o){Ot(),Rt();try{if(!o){console.error("Invalid hero ID");return}const a=await te(o);It(a);const n=Object.values(a.skins).find(r=>r.skin_id===window.skinId);if(n)it(a,n),nt(a,n),lt(n,window.modelType);else{console.warn("Skin not found, showing default skin");const r=Object.values(a.skins)[0];r&&(it(a,r),nt(a,r),lt(r,window.modelType))}}catch(a){console.error("Failed to initialize hero view:",a)}}s(i)});
